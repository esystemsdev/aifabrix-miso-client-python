---
name: remove-auto-params
overview: Identify public SDK methods that accept auto-computable request fields and remove those parameters from the public API surface, refactoring internals and docs/tests to rely on request extraction only.
todos:
  - id: audit-public-surface
    content: List public methods/options with auto params
    status: completed
  - id: remove-params
    content: Remove auto params from public APIs
    status: completed
  - id: refactor-internals
    content: Update internals/tests/docs to new API
    status: completed
isProject: false
---

# Remove Auto-Computable Params from Public API

## Scope and Definitions

- Public surface = exports from `[miso_client/__init__.py](/workspace/aifabrix-miso-client-python/miso_client/__init__.py)` (SDK API).
- Auto-computable fields = extended list based on the audit plan (IP, userAgent, correlationId, requestId, referer, requestSize, method, path, userId, sessionId, applicationId, token, headers/host/query when relevant) from `[.cursor/plans/done/31-audit-autofill-context_b3155338.plan.md](/workspace/aifabrix-miso-client-python/.cursor/plans/done/31-audit-autofill-context_b3155338.plan.md)` and request extraction utilities.
- Hard removal: delete these parameters from public method signatures/options and adjust usages to rely on request extraction (`with_request()` / middleware) or internal context.

## Rules and Standards

This plan must comply with the following sections from [Project Rules](/workspace/aifabrix-miso-client-python/.cursor/rules/project-rules.mdc):

- **[Architecture Patterns](/workspace/aifabrix-miso-client-python/.cursor/rules/project-rules.mdc#architecture-patterns)** - Service/middleware patterns and logger context usage.
- **[Code Style](/workspace/aifabrix-miso-client-python/.cursor/rules/project-rules.mdc#code-style)** - Type hints, naming, and error handling.
- **[Testing Conventions](/workspace/aifabrix-miso-client-python/.cursor/rules/project-rules.mdc#testing-conventions)** - pytest and async mocking.
- **[Security Guidelines](/workspace/aifabrix-miso-client-python/.cursor/rules/project-rules.mdc#security-guidelines)** - Data masking and sensitive data handling.
- **[Code Size Guidelines](/workspace/aifabrix-miso-client-python/.cursor/rules/project-rules.mdc#code-size-guidelines)** - Method size limits.
- **[Documentation](/workspace/aifabrix-miso-client-python/.cursor/rules/project-rules.mdc#documentation)** - Docstrings and docs updates.

**Key Requirements**:

- Keep request-derived fields internal; public APIs must not require them.
- Preserve data masking and avoid logging sensitive data.
- Maintain type hints and Google-style docstrings for public methods.
- Keep methods under 20-30 lines (extract helpers if needed).
- Update tests for removed/changed public methods.

## Before Development

- Inventory all exported public APIs from `miso_client/__init__.py`.
- Map auto-computable fields to request extraction utilities.
- Identify all call sites in tests and docs that pass auto-computable params.

## Definition of Done

1. **Lint**: Run `ruff check` with zero errors.
2. **Format**: Run `black` and `isort`.
3. **Type Check**: Run `mypy` with zero errors.
4. **Test**: Run `pytest`; all tests pass.
5. **Validation Order**: LINT → FORMAT → TYPE CHECK → TEST.
6. **Public API**: No exported public methods accept auto-computable request fields.
7. **Docs**: README updated to reflect the new usage.
8. **Tests**: Updated/added tests cover new usage patterns.

## Identify Public APIs with Auto-Computable Parameters

- Review exported classes/functions in `[miso_client/__init__.py](/workspace/aifabrix-miso-client-python/miso_client/__init__.py)` to define the public surface.
- Enumerate public logging APIs and options where auto-computable fields can be passed:
  - `LoggerService` methods accepting `ClientLoggingOptions` or `token` (e.g., `[miso_client/services/logger.py](/workspace/aifabrix-miso-client-python/miso_client/services/logger.py)`)
  - `LoggerChain` fluent methods that accept `userId`, `applicationId`, `correlationId`, `token`, `request_size`, etc. (see `[miso_client/services/logger_chain.py](/workspace/aifabrix-miso-client-python/miso_client/services/logger_chain.py)`)
  - `ClientLoggingOptions` fields that expose auto-computable values (see `[miso_client/models/config.py](/workspace/aifabrix-miso-client-python/miso_client/models/config.py)`).

## Plan of Changes

1. **Public API audit list**
  - Produce a concrete list of public methods/params to remove (signatures + file paths), focusing on logging entrypoints (`LoggerService`, `LoggerChain`, `ClientLoggingOptions`, helper utilities if exported).
2. **Remove auto-computable params from public surface**
  - Remove/rename public methods that accept auto-computable values (e.g., token/userId/applicationId/correlationId/requestSize) from `LoggerChain` and `LoggerService` where they are exposed to consumers.
  - Remove auto-computable fields from `ClientLoggingOptions` if it is exposed publicly; replace with internal-only usage where required.
  - Ensure request-based APIs remain (e.g., `with_request()`), so consumers use request extraction rather than manual parameters.
3. **Refactor internal usage**
  - Update internal helpers (e.g., `[miso_client/utils/logger_request_helpers.py](/workspace/aifabrix-miso-client-python/miso_client/utils/logger_request_helpers.py)`) and any call sites to rely on request extraction or internal context rather than removed params.
4. **Report simplified public interfaces**
  - Add a dedicated report section enumerating each public method changed, the removed params, and the new signature.
5. **Update docs and exports**
  - Update SDK documentation (`README.md`) to explain the preferred usage via request/middleware and remove references to manual IP/token/UA/etc. parameters.
  - Adjust `__all__` exports in `[miso_client/__init__.py](/workspace/aifabrix-miso-client-python/miso_client/__init__.py)` if any removed public APIs are still exported.
6. **Tests and validation**
  - Update or remove tests that pass auto-computable params into public methods and replace with request-context-based tests.
  - Run format/lint/type-check/test per project rules.

## Public Interface Simplification Report

### Removed methods and parameters

- `miso_client/services/logger.py`
  - Removed `LoggerService.with_token(token: str) -> LoggerChain`
  - Removed `LoggerService.get_with_token(token: str, message: str, level=..., context=None, stack_trace=None) -> LogEntry`
- `miso_client/services/logger_chain.py`
  - Removed `LoggerChain.add_user(user_id: str) -> LoggerChain`
  - Removed `LoggerChain.add_application(application_id: str) -> LoggerChain`
  - Removed `LoggerChain.add_correlation(correlation_id: str) -> LoggerChain`
  - Removed `LoggerChain.add_session(session_id: str) -> LoggerChain`
  - Removed `LoggerChain.with_token(token: str) -> LoggerChain`
  - Removed `LoggerChain.with_application_id(application_id: str) -> LoggerChain`
  - Updated `LoggerChain.with_request_metrics(...)` to drop `request_size` parameter
- `miso_client/models/config.py`
  - Removed auto-computable fields from `ClientLoggingOptions`:
  `applicationId`, `userId`, `correlationId`, `requestId`, `sessionId`, `token`, `ipAddress`, `userAgent`, `requestSize`

### Updated behavior (same public entrypoints)

- Auto-computable fields are now promoted from context (request/middleware or `set_logger_context`) instead of public params.
- `LoggerService` and `UnifiedLogger` now rely on context data to populate top-level `LogEntry` fields (user/session/correlation/IP/UA/requestSize).

## Notes / Risks

- Hard removal is a breaking change; ensure documentation clearly points to `with_request()`/middleware as the required path for request-derived context.
- If any non-web consumers relied on manual fields, they will need to adapt (document migration path).

## Plan Validation Report

**Date**: 2026-02-04  
**Plan**: `/workspace/aifabrix-miso-client-python/.cursor/plans/31.1-remove-auto-params_6cad832a.plan.md`  
**Status**: ✅ VALIDATED

### Plan Purpose

Remove auto-computable request fields from the SDK public API, enforce request-based extraction for consumer-facing methods, and include an explicit interface simplification report.

### Applicable Rules

- ✅ Architecture patterns apply to logger/middleware usage.
- ✅ Code style and type hints required for API changes.
- ✅ Testing conventions apply to updated public methods.
- ✅ Security guidelines apply to logging data.
- ✅ Code size and documentation rules apply.

### Rule Compliance

- ✅ Public surface defined via `miso_client/__init__.py`.
- ✅ Auto-computable fields defined via audit plan and request extraction.
- ✅ Breaking change noted with migration expectations.
- ✅ Public Interface Simplification Report section included.

## Validation

**Date**: 2026-02-04  
**Status**: ✅ COMPLETE

### Executive Summary

All tasks are complete. Public APIs no longer accept auto-computable request fields, documentation/examples have been updated, and tests pass.

### File Existence Validation

- ✅ `README.md` - usage examples updated
- ✅ `miso_client/models/config.py` - `ClientLoggingOptions` auto-fields removed
- ✅ `miso_client/services/logger.py` - public methods updated and token-based helpers removed
- ✅ `miso_client/services/logger_chain.py` - auto-field chain methods removed
- ✅ `miso_client/services/unified_logger.py` - context handling updated
- ✅ `miso_client/utils/logger_helpers.py` - context splitting/promoting added
- ✅ `miso_client/utils/logger_request_helpers.py` - request helper updates
- ✅ `test_integration.py` - logger chain integration examples updated
- ✅ `tests/unit/test_logger.py` - updated logger service tests
- ✅ `tests/unit/test_logger_chain.py` - updated chain tests
- ✅ `tests/unit/test_miso_client.py` - updated client tests
- ✅ `tests/unit/test_unified_logger.py` - updated unified logger tests

### Test Coverage

- ✅ Unit tests updated for public API changes
- ✅ Integration tests not required by plan

### Code Quality Validation

**STEP 1 - FORMAT**: ✅ PASSED (`make -C /workspace/aifabrix-miso-client-python format`)  
**STEP 2 - LINT**: ✅ PASSED (`make -C /workspace/aifabrix-miso-client-python lint`, 0 errors)  
**STEP 3 - TYPE CHECK**: ✅ PASSED (`make -C /workspace/aifabrix-miso-client-python type-check`, no issues; mypy notes about unchecked untyped bodies only)  
**STEP 4 - TEST**: ✅ PASSED (`make -C /workspace/aifabrix-miso-client-python test`, 1257 passed)

### Cursor Rules Compliance

- ✅ Code reuse: PASSED
- ✅ Error handling: PASSED
- ✅ Logging: PASSED
- ✅ Type safety: PASSED
- ✅ Async patterns: PASSED
- ✅ HTTP client patterns: PASSED
- ✅ Token management: PASSED
- ✅ Redis caching: PASSED
- ✅ Service layer patterns: PASSED
- ✅ Security: PASSED
- ✅ API data conventions: PASSED
- ✅ File size guidelines: PASSED

### Implementation Completeness

- ✅ Services: COMPLETE
- ✅ Models: COMPLETE
- ✅ Utilities: COMPLETE
- ✅ Documentation: COMPLETE
- ✅ Exports: COMPLETE

### Issues and Recommendations

- None.

### Final Validation Checklist

- [x] All tasks completed
- [x] All files exist
- [x] Tests exist and pass
- [x] Code quality validation passes
- [x] Cursor rules compliance verified
- [x] Implementation complete

**Result**: ✅ **VALIDATION PASSED** - Plan implementation is complete and verified.

